<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>申请上传音乐 | 本地文件支持</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .input-focus { @apply focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent; }
    .btn-hover { @apply hover:bg-blue-600 hover:shadow-md transition-all duration-200; }
    .file-preview { @apply mt-2 p-2 bg-gray-50 rounded border border-gray-200 text-sm text-gray-600; }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 flex items-center justify-center">
  <div class="w-full max-w-md bg-white rounded-lg shadow-md p-6 md:p-8">
    <div class="mb-6 text-left">
      <button onclick="goBackHome()" class="text-blue-500 hover:text-blue-700 text-sm flex items-center gap-1">
        ← 返回收听主页
      </button>
    </div>

    <h2 class="text-2xl font-bold text-center text-gray-800 mb-2">申请上传本地音乐</h2>
    <p class="text-center text-gray-500 mb-6">上传本地音乐并填写信息，申请开通上传权限</p>

    <form id="applyForm" class="space-y-5">
      <!-- 邮箱 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">你的邮箱地址 <span class="text-red-500">*</span></label>
        <input type="email" id="userEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus" placeholder="接收审核结果">
      </div>

      <!-- 标题 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">申请标题 <span class="text-red-500">*</span></label>
        <input type="text" id="applyTitle" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus" placeholder="例如：申请上传本地收藏的80年代粤语歌">
      </div>

      <!-- 本地音乐选择+预览 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">选择本地音乐文件（MP3/WAV，≤100MB）<span class="text-red-500">*</span></label>
        <input type="file" id="localMusic" accept="audio/mp3,audio/wav,audio/mpeg" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus file:mr-4 file:py-2 file:px-4 file:border-0 file:rounded file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" onchange="previewLocalMusic(event)">
        <div id="filePreview" class="file-preview hidden">
          <p id="fileName" class="truncate"></p>
          <p id="fileSize" class="text-xs text-gray-500"></p>
          <audio id="audioPreview" controls class="w-full mt-2 rounded-lg" crossorigin="anonymous">
        </div>
      </div>

      <!-- 申请内容 -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">申请内容 <span class="text-red-500">*</span></label>
        <textarea id="applyContent" rows="4" required class="w-full px-4 py-2 border border-gray-300 rounded-lg input-focus resize-none" placeholder="说明音乐风格、数量、用途等"></textarea>
      </div>

      <!-- 提交按钮 -->
      <button type="submit" class="w-full bg-blue-500 text-white py-3 rounded-lg btn-hover">发送申请邮件</button>
    </form>
  </div>

  <script>
    let selectedFile = null;

    // 返回收听主页
    function goBackHome() { window.location.href = "index.html"; }

    // 预览本地音乐
    function previewLocalMusic(event) {
      selectedFile = event.target.files[0];
      if (!selectedFile) return;

      const previewEl = document.getElementById("filePreview");
      const nameEl = document.getElementById("fileName");
      const sizeEl = document.getElementById("fileSize");
      const audioEl = document.getElementById("audioPreview");

      nameEl.textContent = `文件名：${selectedFile.name}`;
      sizeEl.textContent = `文件大小：${(selectedFile.size / (1024*1024)).toFixed(2)} MB`;
      audioEl.src = URL.createObjectURL(selectedFile);
      previewEl.classList.remove("hidden");
    }

    // 表单提交逻辑
    document.getElementById("applyForm").addEventListener("submit", function(e) {
      e.preventDefault();
      if (!selectedFile) { alert("请选择本地音乐文件"); return; }

      const userEmail = document.getElementById("userEmail").value.trim();
      const applyTitle = document.getElementById("applyTitle").value.trim();
      const applyContent = document.getElementById("applyContent").value.trim();
      const fileInfo = `文件名：${selectedFile.name}\n文件大小：${(selectedFile.size / (1024*1024)).toFixed(2)} MB\n文件类型：${selectedFile.type}`;

      const targetMail = "25eqsg3f08@g.elctp.k12.edu.mo";
      const mailSubject = encodeURIComponent(`【复古音乐库上传申请】${applyTitle}`);
      const mailBody = encodeURIComponent(`
申请人邮箱：${userEmail}
申请标题：${applyTitle}
本地音乐文件信息：
${fileInfo}
申请详细内容：
${applyContent}

---
邮件由复古音乐库申请系统自动生成 | 审核结果将通过邮箱回复
      `.trim());

      window.location.href = `mailto:${targetMail}?subject=${mailSubject}&body=${mailBody}`;
      alert("已唤起邮件客户端，请确认信息无误后发送！");
    });
  </script>
</body>
</html>
